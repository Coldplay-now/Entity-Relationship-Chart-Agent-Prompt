# 美团外卖业务流程可视化分析

## 1. 业务场景综述
美团外卖是一个连接用户、商家、骑手的三方平台业务，用户通过APP下单支付，商家接单制作餐品，骑手负责配送送达，平台协调整个流程并处理支付结算。

## 2. 关键实体描述
- **用户/顾客**: 下单支付、收货确认、评价反馈
- **美团APP**: 用户界面、订单管理、支付处理
- **商家/餐厅**: 接收订单、制作餐品、出餐准备
- **商家POS系统**: 订单接收、后厨指令、状态更新
- **骑手/配送员**: 接单取餐、配送运输、送达确认
- **配送调度系统**: 订单分配、路线规划、骑手管理
- **支付系统**: 交易处理、资金结算、退款管理
- **评价系统**: 反馈收集、评分统计、商家评级

## 3. 静态拓扑图
```mermaid
graph TB
    A[用户/顾客]:::user
    B[美团APP]:::app
    C[商家POS系统]:::pos
    D[商家/餐厅]:::merchant
    E[骑手/配送员]:::rider
    F[配送调度系统]:::dispatch
    G[支付系统]:::payment
    H[评价系统]:::rating



    %% 核心业务协作关系
    A -- 1.浏览下单支付 --> B
    B -- 2.推送订单信息 --> C
    C -- 3.分配制作任务 --> D
    D -- 4.完成餐品制作 --> C
    B -- 5.分配配送任务 --> F
    F -- 6.指派骑手接单 --> E
    E -- 7.到店取餐 --> D
    E -- 8.配送送达 --> A
    A -- 9.确认收货 --> B
    B -- 10.处理支付结算 --> G
    A -- 11.提交评价反馈 --> H
    H -- 12.更新商家评分 --> D
    C -- 13.同步订单状态 --> B
    B -- 14.通知用户进度 --> A
```

## 4. 时序图
```mermaid
sequenceDiagram
    participant User as 用户
    participant App as 美团APP
    participant POS as 商家POS
    participant Merchant as 商家
    participant Dispatch as 配送系统
    participant Rider as 骑手
    participant Payment as 支付系统
    participant Rating as 评价系统

    Note over User,Rating: 阶段一：下单支付
    User->>App: 1.浏览菜单选择商品
    User->>App: 2.提交订单并立即支付
    App->>Payment: 3.处理支付交易
    Payment-->>App: 4.支付成功确认
    
    Note over User,Rating: 阶段二：订单分配
    App->>POS: 5.推送订单信息
    App->>Dispatch: 6.请求配送分配
    Dispatch->>Rider: 7.指派配送任务
    Rider-->>Dispatch: 8.确认接单
    
    Note over User,Rating: 阶段三：餐品制作
    POS->>Merchant: 9.通知制作餐品
    Merchant->>POS: 10.餐品制作完成
    POS->>App: 11.更新订单状态(制作中)
    App->>User: 12.通知制作进度
    
    Note over User,Rating: 阶段四：配送取餐
    Rider->>Merchant: 13.到店取餐
    Merchant->>Rider: 14.交接餐品
    Rider->>App: 15.确认已取餐
    App->>User: 16.通知配送中
    
    Note over User,Rating: 阶段五：送达完成
    Rider->>User: 17.配送送达
    User->>App: 18.确认收货
    App->>Payment: 19.完成资金结算
    User->>Rating: 20.提交评价反馈
    Rating->>Merchant: 21.更新商家评分
```

## 5. 关键业务关系说明

### 核心协作关系
1. **用户-APP关系**: 下单支付、进度查看、收货确认
2. **APP-商家关系**: 订单推送、状态同步、结算处理
3. **商家-骑手关系**: 餐品交接、取餐确认
4. **骑手-用户关系**: 配送服务、送达确认
5. **平台协调关系**: 订单分配、状态管理、支付结算

### 主要数据流
- **订单数据流**: 用户→APP→商家→骑手→用户
- **支付数据流**: 用户→支付系统→商家结算
- **状态数据流**: 实时双向同步各环节状态
- **评价数据流**: 用户→评价系统→商家评级

## 6. 业务流程描述

### 正向业务流程
1. **下单阶段**: 用户浏览选择→提交订单→立即支付
2. **分配阶段**: APP推送订单→商家接单→系统分配骑手
3. **制作阶段**: 商家制作餐品→标记完成→状态更新
4. **配送阶段**: 骑手取餐→配送运输→送达用户
5. **完成阶段**: 用户确认→支付结算→评价反馈

### 业务特点
- **实时性要求高**: 各环节状态需要实时同步
- **三方协同**: 用户、商家、骑手三方高效协作
- **支付前置**: 下单时立即完成支付
- **状态驱动**: 订单状态驱动整个业务流程
- **闭环管理**: 从下单到评价的完整业务闭环